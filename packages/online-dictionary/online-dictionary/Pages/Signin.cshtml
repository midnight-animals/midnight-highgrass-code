@page
@model online_dictionary.Pages.SigninModel
@{
	ViewData["Title"] = "Signin";
}

<div id="sign-in">
	<h1>Sign in</h1>
	<hr/>
	<form id="sign-in-form">
		<label for="usernameOrEmail">Username or Email</label>
		<input type="text" v-model="usernameOrEmail" required/>
		<label for="password">Password</label>
		<input type="password" v-model="password" required/>
		<button type="submit">Login</button>
	</form>
</div>

<style>
	h1 {
		font-size: 2.5rem
	}

	#sign-in-form {
		display: flex;
		flex-direction: column;
		max-width: 20rem;
	}
</style>
<script>
	const app = Vue.createApp({
		data() {
			return {
				usernameOrEmail: "",
				password: "",
			}
		},
		mounted() {
			const form = document.getElementById('sign-in-form');
			form.addEventListener('submit', this.loginUser);
		},
		methods: {
			async loginUser(event) {
				event.preventDefault();
				try {
					const response = await fetch('/api/auth/login', {
						method: 'POST',
						headers: {
							"Content-Type": "application/json"
						},
						body: JSON.stringify({
							usernameOrEmail: this.usernameOrEmail,
							password: this.password,
						})
					})

					if (!response.ok) throw new Error(response);

					const data = await response.json();
					console.log(data);
					alert("Logged in successful. Redirecting");
					window.location.href = "/";
				} catch (error) {
					console.error(error);
					alert('An error occurred while signing in. Please try again later.')
				}
			}
		}
	})

	app.mount('#sign-in')
</script>
